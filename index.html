<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>LINE Check In / Check Out</title>
    <style>
      body {
        font-family: "Prompt", sans-serif;
        text-align: center;
        background: #f5f7fa;
        margin: 0;
        padding: 0;
      }
      h2 {
        color: #333;
        margin-top: 30px;
      }
      button {
        width: 160px;
        height: 50px;
        font-size: 18px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        margin: 10px;
        color: #fff;
      }
      #checkinBtn {
        background-color: #28a745;
      }
      #checkoutBtn {
        background-color: #dc3545;
      }
      #status {
        margin-top: 20px;
        font-size: 16px;
      }
    </style>
  </head>

  <body>
    <h2>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å</h2>

    <button id="checkinBtn">Check In</button>
    <button id="checkoutBtn">Check Out</button>

    <div id="status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞...</div>

    <script>
      // ‚úÖ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà
      const SCRIPT_URL =
        "https://script.google.com/macros/s/AKfycbx2fI1aHqDQTIz6amu_8ZFgSTu-p2rv6FmxQxQYSwZtk_LcTQaPohwOYjpmkuTZc_Jb/exec";
      const userId = "U17814d04672b1adfcd8fe146d8bcb343"; // üî∏ ‡∏™‡∏°‡∏°‡∏∏‡∏ï‡∏¥ userId (‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö LINE ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å liff.getProfile())
      const date = new Date().toLocaleDateString("th-TH", {
        day: "2-digit",
        month: "2-digit",
        year: "numeric",
      });

      // ‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
      async function loadStatus() {
        const res = await fetch(
          `${SCRIPT_URL}?action=checkStatus&userId=${userId}&date=${date}`
        );
        const data = await res.json();

        if (data.todayStatus.checkedIn && !data.todayStatus.checkedOut) {
          document.getElementById("status").innerText =
            "‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏ä‡πá‡∏Å‡∏≠‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏ß‡∏•‡∏≤: " + data.todayStatus.checkinTime;
          document.getElementById("checkinBtn").disabled = true;
        } else if (data.todayStatus.checkedOut) {
          document.getElementById("status").innerText =
            "‡πÄ‡∏ä‡πá‡∏Å‡πÄ‡∏≠‡∏≤‡∏ï‡πå‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏ß‡∏•‡∏≤: " + data.todayStatus.checkoutTime;
          document.getElementById("checkinBtn").disabled = true;
          document.getElementById("checkoutBtn").disabled = true;
        } else {
          document.getElementById("status").innerText = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡πá‡∏Å‡∏≠‡∏¥‡∏ô";
        }
      }

      // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á Check In / Out
      async function sendAction(actionType) {
        const res = await fetch(
          `${SCRIPT_URL}?action=${actionType}&userId=${userId}&date=${date}`
        );
        const result = await res.json();

        if (result.status === "success") {
          if (actionType === "checkin") {
            alert("‡πÄ‡∏ä‡πá‡∏Å‡∏≠‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÄ‡∏ß‡∏•‡∏≤: " + result.time);
          } else {
            alert("‡πÄ‡∏ä‡πá‡∏Å‡πÄ‡∏≠‡∏≤‡∏ï‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÄ‡∏ß‡∏•‡∏≤: " + result.time);
          }
          loadStatus();
        } else {
          alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + result.message);
        }
      }

      // ‚úÖ ‡∏ú‡∏π‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î
      document
        .getElementById("checkinBtn")
        .addEventListener("click", () => sendAction("checkin"));
      document
        .getElementById("checkoutBtn")
        .addEventListener("click", () => sendAction("checkout"));

      loadStatus();
    </script>
  </body>
</html>
